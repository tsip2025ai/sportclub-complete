
<html lang="el">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta name="theme-color" content="#14a34b"/>
<meta name="description" content="Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î‘Î¸Î»Î·Ï„Î¹ÎºÎ¿Ï Î£Ï‰Î¼Î±Ï„ÎµÎ¯Î¿Ï…"/>
<link rel="manifest" href="manifest.json"/>
<link rel="icon" type="image/png" href="icon-192.png"/>
<title>SportClub Pro Manager</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
:root{--bg-primary:#0a0a12;--bg-secondary:#12121e;--bg-card:#1a1a2a;--accent:#14a34b;--accent-dark:#0d7a35;--text-primary:#e0e0e0;--text-secondary:#a0a0b0;--border:#2a2a3a;--success:#14a34b;--warning:#f59e0b;--danger:#ef162a;--info:#0ea5e9;--purple:#a855f7;--shadow:0 4px 6px -1px rgba(0,0,0,0.3)}
[data-theme="light"]{--bg-primary:#f5f5f5;--bg-secondary:#fff;--bg-card:#fff;--text-primary:#1a1a1a;--text-secondary:#666;--border:#e0e0e0;--shadow:0 4px 6px -1px rgba(0,0,0,0.1)}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;display:flex;flex-direction:column;line-height:1.5;transition:background .3s,color .3s;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
header{background:var(--bg-secondary);border-bottom:2px solid var(--accent);padding:.75rem;box-shadow:var(--shadow);position:sticky;top:0;z-index:100}
.header-inner{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:.5rem;font-size:1rem;font-weight:700;color:var(--accent)}
.brand svg{width:24px;height:24px;flex-shrink:0}
.status-indicators{display:flex;gap:.5rem;align-items:center;font-size:.75rem;flex-wrap:wrap}
.status{display:flex;align-items:center;gap:.25rem;font-weight:500}
.status-dot{width:8px;height:8px;border-radius:50%;background:var(--text-secondary)}
.status-dot.online{background:var(--success);animation:pulse-dot 2s infinite}
.status-dot.syncing{background:var(--info);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes pulse-dot{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
.nav-tabs{display:flex;gap:.25rem;overflow-x:auto;scrollbar-width:none;padding:.25rem 0}
.nav-tabs::-webkit-scrollbar{display:none}
.tab-btn{padding:.4rem .7rem;border:none;background:0 0;color:var(--text-secondary);font-size:.75rem;font-weight:500;cursor:pointer;border-radius:.5rem;white-space:nowrap;transition:all .2s;display:flex;align-items:center;gap:.3rem;flex-shrink:0}
.tab-btn:hover{background:var(--bg-card);color:var(--text-primary)}
.tab-btn.active{background:var(--accent);color:#fff}
main{flex:1;max-width:1400px;width:100%;margin:0 auto;padding:.5rem;padding-bottom:2rem}
.view{display:none;animation:fadeIn .3s}.view.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:.75rem;padding:.875rem;box-shadow:var(--shadow);margin-bottom:.75rem}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.875rem;flex-wrap:wrap;gap:.5rem}
.card-title{font-size:.95rem;font-weight:700;display:flex;align-items:center;gap:.5rem}
.btn{padding:.45rem .7rem;border:1px solid var(--border);background:var(--bg-secondary);color:var(--text-primary);border-radius:.5rem;font-size:.75rem;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:.3rem;transition:all .2s;text-decoration:none;white-space:nowrap;user-select:none}
.btn:hover{background:var(--border)}
.btn:active{transform:scale(.95)}
.btn-primary{background:var(--accent);border-color:var(--accent);color:#fff}
.btn-primary:hover{background:var(--accent-dark)}
.btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}
.btn-danger:hover{background:#d11020}
.btn-purple{background:var(--purple);border-color:var(--purple);color:#fff}
.btn-purple:hover{background:#9333ea}
.btn:disabled{opacity:.5;cursor:not-allowed;pointer-events:none}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:.65rem}
.stat-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:.5rem;padding:.75rem;text-align:center;cursor:pointer;transition:all .3s}
.stat-value{font-size:1.6rem;font-weight:800;color:var(--accent);line-height:1}
.stat-label{font-size:.7rem;color:var(--text-secondary);margin-top:.25rem}
.stat-icon{font-size:1.1rem;margin-bottom:.4rem}
.team-selector{display:flex;gap:.5rem;margin-bottom:.875rem;flex-wrap:wrap;overflow-x:auto;scrollbar-width:none}
.team-chip{padding:.45rem .875rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:9999px;font-size:.75rem;cursor:pointer;transition:all .2s;white-space:nowrap}
.team-chip:hover,.team-chip.active{background:var(--accent);border-color:var(--accent);color:#fff}
.player-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:.75rem;padding:.75rem;margin-bottom:.65rem;position:relative}
.player-card-header{display:flex;align-items:center;gap:.65rem;margin-bottom:.65rem}
.player-avatar{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--accent) 0%,var(--accent-dark) 100%);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;color:#fff;position:relative;overflow:hidden}
.player-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;font-size:.7rem}
.player-stat{text-align:center;padding:.45rem;background:var(--bg-card);border-radius:.5rem}
.player-stat-value{font-size:1rem;font-weight:700;color:var(--accent)}
.player-stat-label{color:var(--text-secondary);font-size:.65rem}
.badge{display:inline-flex;padding:.125rem .45rem;border-radius:9999px;font-size:.65rem;font-weight:600;text-transform:uppercase}
.badge.active{background:var(--success);color:#fff}
.badge.inactive{background:var(--danger);color:#fff}
.badge.event{background:var(--purple);color:#fff}
.form-group{display:grid;gap:.25rem;margin-bottom:.75rem}
label{font-size:.75rem;font-weight:500;color:var(--text-secondary)}
input,select,textarea{padding:.55rem .65rem;border:1px solid var(--border);border-radius:.5rem;background:var(--bg-secondary);color:var(--text-primary);font-size:.8rem;transition:all .2s;width:100%}
input:focus,select:focus,textarea:focus{outline:0;border-color:var(--accent);box-shadow:0 0 0 3px rgba(20,163,75,.1)}
.form-actions{display:flex;gap:.5rem;justify-content:flex-end;margin-top:.875rem;flex-wrap:wrap}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;align-items:center;justify-content:center;padding:.75rem;overflow-y:auto}
.modal.active{display:flex}
.modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:.75rem;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;padding:1rem}
.modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.875rem}
.close-btn{background:0 0;border:none;color:var(--text-secondary);font-size:1.5rem;cursor:pointer;padding:.25rem;transition:all .2s;line-height:1}
.close-btn:hover{color:var(--text-primary)}
.list-empty{text-align:center;padding:1.5rem;color:var(--text-secondary);font-size:.8rem}
.attendance-mark{width:2.5rem;height:2.5rem;border-radius:.5rem;border:2px solid var(--border);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;transition:all .2s}
.attendance-mark.present{background:var(--success);border-color:var(--success);color:#fff}
.attendance-mark.absent{background:var(--danger);border-color:var(--danger);color:#fff}
.schedule-item{display:flex;align-items:center;justify-content:space-between;padding:.65rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:.5rem;margin-bottom:.5rem;gap:.5rem}
.theme-toggle{cursor:pointer;padding:.4rem;border-radius:.5rem;transition:all .2s;font-size:1.1rem;display:flex;align-items:center;justify-content:center}
.theme-toggle:hover{background:var(--bg-card)}
.progress-bar{width:100%;height:8px;background:var(--bg-secondary);border-radius:9999px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent) 0%,var(--accent-dark) 100%);transition:width .5s}
.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.65rem}
.toggle-switch{display:flex;align-items:center;gap:.65rem;padding:.4rem 0}
.toggle-switch input[type=checkbox]{width:42px;height:21px;appearance:none;background:var(--bg-secondary);border:1px solid var(--border);border-radius:9999px;position:relative;cursor:pointer;transition:all .3s}
.toggle-switch input[type=checkbox]::before{content:"";position:absolute;top:2px;left:2px;width:15px;height:15px;background:var(--text-secondary);border-radius:50%;transition:all .3s}
.toggle-switch input[type=checkbox]:checked{background:var(--accent);border-color:var(--accent)}
.toggle-switch input[type=checkbox]:checked::before{transform:translateX(21px);background:#fff}
.notification-toast{position:fixed;bottom:.75rem;right:.75rem;left:.75rem;max-width:340px;margin:0 auto;background:var(--bg-card);border:1px solid var(--border);border-radius:.5rem;padding:.875rem;box-shadow:var(--shadow);transform:translateY(150%);transition:transform .3s;z-index:300;font-size:.8rem}
.notification-toast.show{transform:translateY(0)}
.notification-toast.success{border-left:4px solid var(--success)}
.notification-toast.error{border-left:4px solid var(--danger)}
.notification-toast.info{border-left:4px solid var(--info)}
.notification-toast.warning{border-left:4px solid var(--warning)}
.chart-container{position:relative;height:220px;margin-top:.875rem}
.bar-chart{display:flex;align-items:flex-end;justify-content:space-around;height:100%;gap:.35rem;padding:.875rem 0}
.bar{flex:1;background:linear-gradient(180deg,var(--accent) 0%,var(--accent-dark) 100%);border-radius:.25rem .25rem 0 0;position:relative;min-height:2px;transition:all .5s}
.bar-label{position:absolute;bottom:-1.5rem;left:50%;transform:translateX(-50%);font-size:.65rem;color:var(--text-secondary);white-space:nowrap}
.bar-value{position:absolute;top:-1.5rem;left:50%;transform:translateX(-50%);font-size:.65rem;font-weight:600;color:var(--accent)}
.search-box{display:flex;gap:.5rem;margin-bottom:.875rem;flex-wrap:wrap}
.search-box input{flex:1;min-width:140px}
.search-box select{min-width:110px}
.calendar-view{display:grid;grid-template-columns:repeat(7,1fr);gap:.35rem;margin-top:.875rem}
.calendar-day{aspect-ratio:1;border:1px solid var(--border);border-radius:.5rem;padding:.35rem;font-size:.65rem;cursor:pointer;transition:all .2s;display:flex;flex-direction:column;align-items:center;justify-content:center}
.calendar-day.has-training{background:var(--accent);color:#fff;font-weight:600}
.calendar-day.has-event{background:var(--purple);color:#fff;font-weight:600}
.calendar-day.today{border:2px solid var(--info)}
.sync-code{font-size:1.15rem;font-weight:800;letter-spacing:.18rem;color:var(--accent);padding:.875rem;background:var(--bg-secondary);border:2px solid var(--accent);border-radius:.5rem;text-align:center;margin:.875rem 0;word-break:break-all;user-select:all;font-family:monospace}
.info-box{background:var(--info);color:#000;padding:.875rem;border-radius:.5rem;margin-bottom:.875rem;font-size:.75rem}
.install-prompt{background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;padding:.875rem;border-radius:.5rem;margin-bottom:.875rem;display:none;align-items:center;gap:.65rem}
.install-prompt.show{display:flex}
.install-prompt button{background:#fff;color:var(--accent);border:none;padding:.45rem .875rem;border-radius:.5rem;font-weight:600;cursor:pointer;font-size:.75rem}
.event-card{background:var(--bg-secondary);border-left:4px solid var(--purple);border-radius:.5rem;padding:.75rem;margin-bottom:.65rem}
.notes-section{background:var(--bg-card);border:1px solid var(--border);border-radius:.5rem;padding:.65rem;margin-top:.5rem}
.notes-section textarea{min-height:60px;font-size:.75rem}
.reminder-badge{background:var(--warning);color:#000;padding:.25rem .5rem;border-radius:.5rem;font-size:.65rem;font-weight:700;display:inline-flex;align-items:center;gap:.25rem;animation:pulse 2s infinite}
@media(max-width:768px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .settings-grid{grid-template-columns:1fr}
  main{padding:.4rem}
  .card{padding:.75rem;margin-bottom:.65rem}
  .brand{font-size:.9rem}
  .nav-tabs{gap:.2rem}
  .tab-btn{padding:.35rem .6rem;font-size:.7rem}
}
</style>
</head>
<body>

<div class="install-prompt" id="installPrompt">
  <div style="flex:1">ğŸ“± <strong>Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</strong><br>Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î¿Î¸ÏŒÎ½Î·</div>
  <button id="installBtn">Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</button>
  <button onclick="document.getElementById('installPrompt').classList.remove('show')" style="background:transparent;color:#fff;">âœ•</button>
</div>

<header>
<div class="header-inner">
<div class="brand">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
<span id="brandName">SportClub Pro</span>
</div>
<div class="status-indicators">
<div class="theme-toggle" id="themeToggle"><span id="themeIcon">ğŸŒ™</span></div>
<div class="status"><span class="status-dot" id="syncDot"></span><span id="syncStatus">Offline</span></div>
<div class="status" id="timestamp"></div>
</div>
<nav class="nav-tabs">
<button class="tab-btn active" data-view="dashboard">ğŸ“Š Home</button>
<button class="tab-btn" data-view="teams">ğŸ† Î¤Î¼Î®Î¼Î±Ï„Î±</button>
<button class="tab-btn" data-view="players">ğŸ‘¥ Î Î±Î¯ÎºÏ„ÎµÏ‚</button>
<button class="tab-btn" data-view="schedule">ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</button>
<button class="tab-btn" data-view="attendance">âœ“ Î Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚</button>
<button class="tab-btn" data-view="events">ğŸ¯ Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚</button>
<button class="tab-btn" data-view="reports">ğŸ“ˆ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚</button>
<button class="tab-btn" data-view="settings">âš™ï¸</button>
</nav>
</div>
</header>

<main>
<!-- DASHBOARD -->
<section class="view active" id="dashboard">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ† Î¤Î¼Î®Î¼Î±</h2></div>
<div class="team-selector" id="dashboardTeamSelector"></div>
</div>

<!-- Training Reminder -->
<div class="card" id="trainingReminder" style="display:none;background:var(--warning);color:#000;border:2px solid var(--warning);">
<div style="display:flex;align-items:center;gap:.75rem;">
<span style="font-size:2rem;">â°</span>
<div style="flex:1;">
<div style="font-weight:700;font-size:.95rem;">Î ÏÎ¿Ï€ÏŒÎ½Î·ÏƒÎ· ÏƒÎ®Î¼ÎµÏÎ±!</div>
<div style="font-size:.8rem;" id="reminderText"></div>
</div>
<button class="btn btn-primary" id="markAttendanceNowBtn">âœ“ Î Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚</button>
</div>
</div>

<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬</h2><span id="currentDate" style="font-size:.7rem;color:var(--text-secondary);"></span></div>
<div class="stats-grid">
<div class="stat-card" onclick="switchView('players')"><div class="stat-icon">ğŸ‘¥</div><div class="stat-value" id="totalPlayers">0</div><div class="stat-label">Î Î±Î¯ÎºÏ„ÎµÏ‚</div></div>
<div class="stat-card"><div class="stat-icon">âœ…</div><div class="stat-value" id="activePlayers">0</div><div class="stat-label">Î•Î½ÎµÏÎ³Î¿Î¯</div></div>
<div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-value" id="todayAttendance">0%</div><div class="stat-label">Î£Î®Î¼ÎµÏÎ±</div></div>
<div class="stat-card" onclick="switchView('events')"><div class="stat-icon">ğŸ¯</div><div class="stat-value" id="upcomingEvents">0</div><div class="stat-label">Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚</div></div>
</div>
</div>
<div class="card"><h2 class="card-title">ğŸ“… Î•Ï€ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÎ¹Ï‚</h2><div id="upcomingSchedule"></div></div>
<div class="card"><h2 class="card-title">ğŸ“Š Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î Î±ÏÎ¿Ï…ÏƒÎ¯Î±</h2><div class="chart-container"><div class="bar-chart" id="weeklyChart"></div></div></div>
</section>

<!-- TEAMS -->
<section class="view" id="teams">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ† Î¤Î¼Î®Î¼Î±Ï„Î±</h2><button class="btn btn-primary" id="addTeamBtn">â•</button></div>
<div id="teamsContainer"></div>
</div>
</section>

<!-- PLAYERS -->
<section class="view" id="players">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ‘¥ Î Î±Î¯ÎºÏ„ÎµÏ‚</h2><button class="btn btn-primary" id="addPlayerBtn">â•</button></div>
<div class="team-selector" id="playerTeamSelector"></div>
<div class="search-box">
<input type="text" id="searchPlayers" placeholder="ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·..."/>
<select id="filterPosition"><option value="">ÎŒÎ»ÎµÏ‚ Î¸Î­ÏƒÎµÎ¹Ï‚</option><option value="Î¤ÎµÏÎ¼Î±Ï„Î¿Ï†ÏÎ»Î±ÎºÎ±Ï‚">Î¤ÎµÏÎ¼Î±Ï„Î¿Ï†ÏÎ»Î±ÎºÎ±Ï‚</option><option value="Î‘Î¼Ï…Î½Ï„Î¹ÎºÏŒÏ‚">Î‘Î¼Ï…Î½Ï„Î¹ÎºÏŒÏ‚</option><option value="ÎœÎ­ÏƒÎ¿Ï‚">ÎœÎ­ÏƒÎ¿Ï‚</option><option value="Î•Ï€Î¹Î¸ÎµÏ„Î¹ÎºÏŒÏ‚">Î•Ï€Î¹Î¸ÎµÏ„Î¹ÎºÏŒÏ‚</option></select>
<select id="filterStatus"><option value="">ÎŒÎ»ÎµÏ‚</option><option value="active">Î•Î½ÎµÏÎ³Î¿Î¯</option><option value="inactive">Î‘Î½ÎµÎ½ÎµÏÎ³Î¿Î¯</option></select>
</div>
<div id="playersContainer"></div>
</div>
</section>

<!-- SCHEDULE -->
<section class="view" id="schedule">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</h2><button class="btn btn-primary" id="addScheduleBtn">â•</button></div>
<div class="team-selector" id="scheduleTeamSelector"></div>
<div class="calendar-view" id="calendarView"></div>
<div id="scheduleList" style="margin-top:.875rem;"></div>
</div>
</section>

<!-- ATTENDANCE -->
<section class="view" id="attendance">
<div class="card">
<div class="card-header"><h2 class="card-title">âœ“ Î Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚</h2>
<div style="display:flex;gap:.4rem;flex-wrap:wrap;">
<input type="date" id="attendanceDate" style="width:auto;"/>
<button class="btn" id="allPresentBtn">âœ…</button>
<button class="btn" id="allAbsentBtn">âŒ</button>
<button class="btn btn-primary" id="quickMarkBtn">âš¡</button>
</div>
</div>
<div class="team-selector" id="attendanceTeamSelector"></div>
<div style="display:flex;gap:.5rem;margin-bottom:.65rem;">
<select id="attendanceEventType" style="flex:1;">
<option value="">ğŸ“‹ ÎŒÎ»Î±</option>
<option value="training">ğŸƒ Î ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÎ¹Ï‚</option>
<option value="event">ğŸ¯ Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚</option>
</select>
<select id="attendanceEventSelect" style="flex:2;"></select>
</div>
<div style="padding:.65rem;background:var(--bg-secondary);border-radius:.5rem;margin-bottom:.65rem;"><strong style="font-size:.8rem;">Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬:</strong> <span id="quickStats" style="font-size:.8rem;">-</span><div class="progress-bar" style="margin-top:.45rem;"><div class="progress-fill" id="attendanceProgress"></div></div></div>
<div id="attendanceContainer"></div>
</div>
</section>

<!-- EVENTS -->
<section class="view" id="events">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ¯ Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚</h2><button class="btn btn-purple" id="addEventBtn">â• Î•ÎºÎ´Î®Î»Ï‰ÏƒÎ·</button></div>
<div class="team-selector" id="eventTeamSelector"></div>
<div id="eventsContainer"></div>
</div>
</section>

<!-- REPORTS -->
<section class="view" id="reports">
<div class="card">
<div class="card-header"><h2 class="card-title">ğŸ“ˆ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚</h2>
<div style="display:flex;gap:.4rem;flex-wrap:wrap;">
<select id="reportPeriod"><option value="week">Î•Î²Î´Î¿Î¼Î¬Î´Î±</option><option value="month" selected>ÎœÎ®Î½Î±Ï‚</option><option value="quarter">Î¤ÏÎ¯Î¼Î·Î½Î¿</option><option value="year">ÎˆÏ„Î¿Ï‚</option></select>
<button class="btn btn-primary" id="generateReportBtn">ğŸ”„</button>
</div>
</div>
<div class="team-selector" id="reportTeamSelector"></div>
<div class="stats-grid">
<div class="stat-card"><div class="stat-value" id="reportTotalSessions">0</div><div class="stat-label">Î ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÎ¹Ï‚</div></div>
<div class="stat-card"><div class="stat-value" id="reportAvgAttendance">0%</div><div class="stat-label">ÎœÎ­ÏƒÎ· Î Î±ÏÎ¿Ï…ÏƒÎ¯Î±</div></div>
<div class="stat-card"><div class="stat-value" id="reportTopPlayer">-</div><div class="stat-label">Top Î Î±Î¯ÎºÏ„Î·Ï‚</div></div>
</div>
</div>
<div class="card"><h2 class="card-title">ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ·</h2><div class="chart-container"><div class="bar-chart" id="playerAttendanceChart"></div></div></div>
</section>

<!-- SETTINGS -->
<section class="view" id="settings">
<div class="card">
<h2 class="card-title">âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</h2>
<div class="settings-grid">
<div class="form-group"><label>ÎŒÎ½Î¿Î¼Î± Î£Ï‰Î¼Î±Ï„ÎµÎ¯Î¿Ï…</label><input type="text" id="clubName"/></div>
<div class="form-group"><label>Î ÏÎ¿Ï€Î¿Î½Î·Ï„Î®Ï‚</label><input type="text" id="coachName"/></div>
</div>
<div class="toggle-switch"><input type="checkbox" id="autoSyncEnabled" checked/><label>Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï‚ Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚</label></div>
<div class="toggle-switch"><input type="checkbox" id="trainingReminders" checked/><label>â° Î¥Ï€ÎµÎ½Î¸Ï…Î¼Î¯ÏƒÎµÎ¹Ï‚ Î ÏÎ¿Ï€ÏŒÎ½Î·ÏƒÎ·Ï‚</label></div>
<div class="toggle-switch"><input type="checkbox" id="autoAttendance"/><label>ğŸ¤– Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ Î Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚</label></div>
</div>

<div class="card">
<h2 class="card-title">ğŸ”„ Multi-Device Sync</h2>
<div class="info-box">
<strong>ğŸ“± Real-time ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚</strong><br>
ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ Î¼Îµ Ï„Î¿Î½ Î¯Î´Î¹Î¿ ÎºÏ‰Î´Î¹ÎºÏŒ ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±
</div>
<div class="sync-code" id="syncCode">XXXX-XXXX</div>
<button class="btn btn-primary" id="generateSyncCodeBtn" style="width:100%;margin-bottom:.5rem;">ğŸ”„ ÎÎ­Î¿Ï‚ ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</button>
<button class="btn" id="enterSyncCodeBtn" style="width:100%;">ğŸ“± Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï</button>
<div style="margin-top:.875rem;padding:.65rem;background:var(--bg-secondary);border-radius:.5rem;font-size:.75rem;">
<div style="display:flex;justify-content:space-between;margin-bottom:.4rem;"><span>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</span><strong id="connectionStatus">-</strong></div>
<div style="display:flex;justify-content:space-between;"><span>Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿Ï‚ sync:</span><strong id="lastSyncTime">-</strong></div>
</div>
</div>

<div class="card">
<h2 class="card-title">ğŸ’¾ Backup</h2>
<div class="settings-grid">
<button class="btn btn-primary" id="backupBtn">ğŸ’¾ ÎšÎ±Ï„Î­Î²Î±ÏƒÎ¼Î±</button>
<button class="btn btn-primary" id="restoreBtn">ğŸ“¤ Î‘Î½Î­Î²Î±ÏƒÎ¼Î±</button>
<input type="file" id="restoreFile" accept=".json" style="display:none;"/>
<button class="btn btn-danger" id="clearDataBtn">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
</div>
</div>

<div class="card">
<h2 class="card-title">ğŸ“± PWA Status</h2>
<div style="padding:.875rem;background:var(--bg-secondary);border-radius:.5rem;font-size:.75rem;">
<div style="display:flex;justify-content:space-between;margin-bottom:.4rem;">
<span>Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</span>
<strong id="pwaStatus">-</strong>
</div>
<div style="display:flex;justify-content:space-between;">
<span>Offline Cache:</span>
<strong id="cacheStatus">-</strong>
</div>
</div>
</div>
</section>
</main>

<!-- MODALS -->
<div class="modal" id="teamModal">
<div class="modal-content">
<div class="modal-header"><h2 id="teamModalTitle">ÎÎ­Î¿ Î¤Î¼Î®Î¼Î±</h2><button class="close-btn" data-close="teamModal">&times;</button></div>
<form id="teamForm">
<div class="form-group"><label>ÎŒÎ½Î¿Î¼Î± *</label><input type="text" id="teamName" required placeholder="Ï€.Ï‡. U15"/></div>
<div class="form-group"><label>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label><textarea id="teamDesc" rows="2"></textarea></div>
<div class="form-group"><label>Î§ÏÏÎ¼Î±</label><input type="color" id="teamColor" value="#14a34b"/></div>
<div class="form-actions"><button type="button" class="btn" data-close="teamModal">Î†ÎºÏ…ÏÎ¿</button><button type="submit" class="btn btn-primary">ğŸ’¾ OK</button></div>
</form>
</div>
</div>

<div class="modal" id="playerModal">
<div class="modal-content">
<div class="modal-header"><h2 id="playerModalTitle">Î Î±Î¯ÎºÏ„Î·Ï‚</h2><button class="close-btn" data-close="playerModal">&times;</button></div>
<form id="playerForm">
<div class="form-group"><label>Î¤Î¼Î®Î¼Î± *</label><select id="playerTeam" required></select></div>
<div class="form-group"><label>ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿ *</label><input type="text" id="playerName" required/></div>
<div class="form-group"><label>Î˜Î­ÏƒÎ· *</label><select id="playerPosition" required><option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ...</option><option value="Î¤ÎµÏÎ¼Î±Ï„Î¿Ï†ÏÎ»Î±ÎºÎ±Ï‚">Î¤ÎµÏÎ¼Î±Ï„Î¿Ï†ÏÎ»Î±ÎºÎ±Ï‚</option><option value="Î‘Î¼Ï…Î½Ï„Î¹ÎºÏŒÏ‚">Î‘Î¼Ï…Î½Ï„Î¹ÎºÏŒÏ‚</option><option value="ÎœÎ­ÏƒÎ¿Ï‚">ÎœÎ­ÏƒÎ¿Ï‚</option><option value="Î•Ï€Î¹Î¸ÎµÏ„Î¹ÎºÏŒÏ‚">Î•Ï€Î¹Î¸ÎµÏ„Î¹ÎºÏŒÏ‚</option></select></div>
<div class="form-group"><label>ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</label><textarea id="playerNotes" rows="3" placeholder="Î™Î´Î¹Î±Î¹Ï„ÎµÏÏŒÏ„Î·Ï„ÎµÏ‚, ÏƒÏ„ÏŒÏ‡Î¿Î¹, Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚..."></textarea></div>
<div class="toggle-switch"><input type="checkbox" id="playerActive" checked/><label>Î•Î½ÎµÏÎ³ÏŒÏ‚</label></div>
<div class="form-actions"><button type="button" class="btn" data-close="playerModal">Î†ÎºÏ…ÏÎ¿</button><button type="submit" class="btn btn-primary">ğŸ’¾ OK</button></div>
</form>
</div>
</div>

<div class="modal" id="scheduleModal">
<div class="modal-content">
<div class="modal-header"><h2>Î ÏÎ¿Ï€ÏŒÎ½Î·ÏƒÎ·</h2><button class="close-btn" data-close="scheduleModal">&times;</button></div>
<form id="scheduleForm">
<div class="form-group"><label>Î¤Î¼Î®Î¼Î± *</label><select id="scheduleTeam" required></select></div>
<div class="form-group"><label>Î—Î¼Î­ÏÎ±</label><select id="scheduleDay"><option value="1" selected>Î”ÎµÏ…Ï„Î­ÏÎ±</option><option value="2">Î¤ÏÎ¯Ï„Î·</option><option value="3">Î¤ÎµÏ„Î¬ÏÏ„Î·</option><option value="4">Î Î­Î¼Ï€Ï„Î·</option><option value="5">Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®</option><option value="6">Î£Î¬Î²Î²Î±Ï„Î¿</option><option value="0">ÎšÏ…ÏÎ¹Î±ÎºÎ®</option></select></div>
<div class="form-group"><label>ÎÏÎ±</label><input type="time" id="scheduleTime" value="18:00" required/></div>
<div class="form-group"><label>Î¤ÏÏ€Î¿Ï‚</label><input type="text" id="scheduleType" required placeholder="Ï€.Ï‡. Î¤Î±ÎºÏ„Î¹ÎºÎ®"/></div>
<div class="form-group"><label>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</label><input type="text" id="scheduleLocation" placeholder="Ï€.Ï‡. Î“Î®Ï€ÎµÎ´Î¿"/></div>
<div class="toggle-switch"><input type="checkbox" id="scheduleAutoAttendance"/><label>ğŸ¤– Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€Î±ÏÎ¿Ï…ÏƒÎ¹ÏÎ½</label></div>
<div class="form-actions"><button type="button" class="btn" data-close="scheduleModal">Î†ÎºÏ…ÏÎ¿</button><button type="submit" class="btn btn-primary">ğŸ’¾ OK</button></div>
</form>
</div>
</div>

<div class="modal" id="eventModal">
<div class="modal-content">
<div class="modal-header"><h2>Î•ÎºÎ´Î®Î»Ï‰ÏƒÎ·</h2><button class="close-btn" data-close="eventModal">&times;</button></div>
<form id="eventForm">
<div class="form-group"><label>Î¤Î¼Î®Î¼Î± *</label><select id="eventTeam" required></select></div>
<div class="form-group"><label>Î¤ÏÏ€Î¿Ï‚ *</label><select id="eventType" required><option value="Î‘Î³ÏÎ½Î±Ï‚">ğŸ† Î‘Î³ÏÎ½Î±Ï‚</option><option value="Î¦Î¹Î»Î¹ÎºÏŒ">âš½ Î¦Î¹Î»Î¹ÎºÏŒ</option><option value="Î¤Î¿Ï…ÏÎ½Î¿Ï…Î¬">ğŸ… Î¤Î¿Ï…ÏÎ½Î¿Ï…Î¬</option><option value="Camp">ğŸ•ï¸ Camp</option><option value="Î•ÎºÎ´Î®Î»Ï‰ÏƒÎ·">ğŸ‰ Î•ÎºÎ´Î®Î»Ï‰ÏƒÎ·</option><option value="Î†Î»Î»Î¿">ğŸ“Œ Î†Î»Î»Î¿</option></select></div>
<div class="form-group"><label>Î¤Î¯Ï„Î»Î¿Ï‚ *</label><input type="text" id="eventTitle" required placeholder="Ï€.Ï‡. Î‘Î³ÏÎ½Î±Ï‚ vs Î‘Î•Îš"/></div>
<div class="form-group"><label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± *</label><input type="date" id="eventDate" required/></div>
<div class="form-group"><label>ÎÏÎ±</label><input type="time" id="eventTime" value="18:00"/></div>
<div class="form-group"><label>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</label><input type="text" id="eventLocation" placeholder="Î“Î®Ï€ÎµÎ´Î¿/Î§ÏÏÎ¿Ï‚"/></div>
<div class="form-group"><label>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label><textarea id="eventDescription" rows="2"></textarea></div>
<div class="form-actions"><button type="button" class="btn" data-close="eventModal">Î†ÎºÏ…ÏÎ¿</button><button type="submit" class="btn btn-purple">ğŸ’¾ OK</button></div>
</form>
</div>
</div>

<div class="modal" id="eventDetailsModal">
<div class="modal-content">
<div class="modal-header"><h2 id="eventDetailsTitle">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</h2><button class="close-btn" data-close="eventDetailsModal">&times;</button></div>
<div id="eventDetailsContent"></div>
<div style="margin-bottom:.875rem;">
<h3 style="font-size:.9rem;margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center;">
<span>âœ“ Î Î±ÏÎ¿Ï…ÏƒÎ¯ÎµÏ‚</span>
<button class="btn btn-primary" id="quickMarkEventBtn">âš¡ Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±</button>
</h3>
<div id="eventAttendanceList"></div>
</div>
<div style="margin-top:1rem;">
<h3 style="font-size:.9rem;margin-bottom:.5rem;">ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ Î Î±Î¹ÎºÏ„ÏÎ½</h3>
<div id="eventPlayerNotes"></div>
</div>
<div class="form-actions"><button class="btn" data-close="eventDetailsModal">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button><button class="btn btn-primary" id="saveEventNotesBtn">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button></div>
</div>
</div>

<div class="modal" id="syncCodeModal">
<div class="modal-content">
<div class="modal-header"><h2>Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï</h2><button class="close-btn" data-close="syncCodeModal">&times;</button></div>
<form id="syncCodeForm">
<div class="form-group"><label>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Sync (8 ÏˆÎ·Ï†Î¯Î±)</label><input type="text" id="syncCodeInput" maxlength="9" placeholder="XXXX-XXXX" style="text-align:center;font-size:1.3rem;letter-spacing:.2rem;text-transform:uppercase;font-weight:700;"/></div>
<p style="font-size:.75rem;color:var(--text-secondary);margin-bottom:.875rem;text-align:center;">Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Î±Ï€ÏŒ Ï„Î·Î½ Î¬Î»Î»Î· ÏƒÏ…ÏƒÎºÎµÏ…Î®</p>
<div class="form-actions"><button type="button" class="btn" data-close="syncCodeModal">Î†ÎºÏ…ÏÎ¿</button><button type="submit" class="btn btn-primary">ğŸ”„ OK</button></div>
</form>
</div>
</div>

<div class="notification-toast" id="toast"></div>

<script>
// ============================================
// ğŸ”¥ FIREBASE CONFIGURATION
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyDJEd_cK18ht8zbidQ9WK0vNvK_rDB5qgo",
  authDomain: "sportclub-7b155.firebaseapp.com",
  databaseURL: "https://sportclub-7b155-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sportclub-7b155",
  storageBucket: "sportclub-7b155.firebasestorage.app",
  messagingSenderId: "621945852010",
  appId: "1:621945852010:web:f639a432f0d13e09b3ba13"
};

let db = null;
let syncRef = null;
let isInitialLoad = true;
let reminderInterval = null;
let currentEventId = null;

try {
  firebase.initializeApp(firebaseConfig);
  db = firebase.database();
  console.log("âœ… Firebase initialized");
} catch (e) {
  console.error("âŒ Firebase error:", e);
}

// ============================================
// ğŸ’¾ STATE
// ============================================
const defaultState={teams:[{id:"default",name:"ÎšÏÏÎ¹Î± ÎŸÎ¼Î¬Î´Î±",description:"",color:"#14a34b"}],players:[],schedules:[],attendance:[],events:[],settings:{clubName:"Î‘Î¸Î»Î·Ï„Î¹ÎºÏŒ Î£Ï‰Î¼Î±Ï„ÎµÎ¯Î¿",coachName:"",theme:"dark",currentTeam:"default",autoSyncEnabled:true,trainingReminders:true,autoAttendance:false},sync:{lastSync:0,syncCode:"",version:1,deviceId:""}};
let appState=JSON.parse(JSON.stringify(defaultState));
let editingPlayerId=null;
let editingScheduleId=null;
let editingTeamId=null;
let editingEventId=null;
let playerFilters={search:"",position:"",status:""};
let saveTimer=null;

// ============================================
// ğŸ”¨ UTILITIES
// ============================================
const $=(s)=>document.querySelector(s);
const $$=(s)=>Array.from(document.querySelectorAll(s));
const uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2);
const todayISO=()=>new Date().toISOString().split("T")[0];
const nowISO=()=>new Date().toISOString();
const dayName=(i)=>["ÎšÏ…Ï","Î”ÎµÏ…","Î¤ÏÎ¹","Î¤ÎµÏ„","Î ÎµÎ¼","Î Î±Ï","Î£Î±Î²"][i];
const dayNameFull=(i)=>["ÎšÏ…ÏÎ¹Î±ÎºÎ®","Î”ÎµÏ…Ï„Î­ÏÎ±","Î¤ÏÎ¯Ï„Î·","Î¤ÎµÏ„Î¬ÏÏ„Î·","Î Î­Î¼Ï€Ï„Î·","Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®","Î£Î¬Î²Î²Î±Ï„Î¿"][i];
const formatTime=(i)=>new Date(i).toLocaleTimeString("el-GR",{hour:"2-digit",minute:"2-digit"});
const formatDate=(i)=>new Date(i).toLocaleDateString("el-GR");
const formatDateTime=(i)=>new Date(i).toLocaleString("el-GR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});
const sortBy=(a,k,d="asc")=>[...a].sort((x,y)=>{let va=x[k],vb=y[k];if(typeof va==="string")va=va.toLowerCase();if(typeof vb==="string")vb=vb.toLowerCase();const r=(va>vb?1:va<vb?-1:0);return d==="asc"?r:-r});
const getInitials=(n)=>{const p=n.trim().split(/\s+/);if(p.length===1)return p[0].substring(0,2).toUpperCase();return(p[0][0]+p[p.length-1][0]).toUpperCase()};
const getPlayerAttendanceRate=(id)=>{const r=appState.attendance.filter(a=>a.playerId===id);if(!r.length)return 0;const p=r.filter(a=>a.attended).length;return Math.round((p/r.length)*100)};
const getCurrentTeam=()=>appState.settings.currentTeam||"default";
const setCurrentTeam=(id)=>{appState.settings.currentTeam=id;saveStateDebounced();renderAllViews()};
const getTeamPlayers=()=>appState.players.filter(p=>p.teamId===getCurrentTeam());
const getTeamSchedules=()=>appState.schedules.filter(s=>s.teamId===getCurrentTeam());
const getTeamEvents=()=>appState.events.filter(e=>e.teamId===getCurrentTeam());

// ============================================
// â° TRAINING REMINDERS
// ============================================
const checkTrainingReminder=()=>{
  if(!appState.settings.trainingReminders)return;
  
  const now=new Date();
  const today=now.getDay();
  const currentTime=now.getHours()*60+now.getMinutes();
  
  const todaySchedules=getTeamSchedules().filter(s=>parseInt(s.dayOfWeek)===today);
  
  todaySchedules.forEach(schedule=>{
    const[hour,minute]=schedule.time.split(':');
    const scheduleTime=parseInt(hour)*60+parseInt(minute);
    const timeDiff=scheduleTime-currentTime;
    
    // Î¥Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ·: 30 Î»ÎµÏ€Ï„Î¬ Ï€ÏÎ¹Î½ Î­Ï‰Ï‚ 30 Î»ÎµÏ€Ï„Î¬ Î¼ÎµÏ„Î¬
    if(timeDiff>=-30 && timeDiff<=30){
      const reminder=$("#trainingReminder");
      const reminderText=$("#reminderText");
      
      if(timeDiff>0){
        reminderText.textContent=`${schedule.type} ÏƒÎµ ${timeDiff} Î»ÎµÏ€Ï„Î¬ - ${schedule.location||'Î“Î®Ï€ÎµÎ´Î¿'}`;
      }else{
        reminderText.textContent=`${schedule.type} Î¤Î©Î¡Î‘! - ${schedule.location||'Î“Î®Ï€ÎµÎ´Î¿'}`;
      }
      
      reminder.style.display="block";
      
      // Auto attendance check
      if(schedule.autoAttendance && timeDiff<=0 && timeDiff>=-5){
        autoMarkAttendance(schedule);
      }
    }else{
      $("#trainingReminder").style.display="none";
    }
  });
};

const autoMarkAttendance=(schedule)=>{
  const date=todayISO();
  const alreadyMarked=appState.attendance.some(a=>a.date===date&&a.eventId===schedule.id);
  
  if(alreadyMarked)return;
  
  if(appState.settings.autoAttendance){
    getTeamPlayers().filter(p=>p.active).forEach(p=>{
      appState.attendance.push({
        id:uid(),
        playerId:p.id,
        date:date,
        attended:false,
        eventType:'training',
        eventId:schedule.id,
        notes:'',
        timestamp:Date.now()
      });
    });
    
    saveState();
    showToast("ğŸ¤– Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± Ï€Î±ÏÎ¿Ï…ÏƒÎ¹ÏÎ½!","info");
  }
};

// ============================================
// ğŸ’¾ STORAGE & SYNC
// ============================================
const saveState=()=>{
  appState.sync.lastSync=Date.now();
  appState.sync.version++;
  
  localStorage.setItem('sportclub:state',JSON.stringify(appState));
  
  if(db && appState.sync.syncCode && appState.settings.autoSyncEnabled){
    try{
      updateSyncStatus('syncing','ğŸ”„ Syncing');
      db.ref(`sync/${appState.sync.syncCode}`).set(appState).then(()=>{
        updateSyncStatus('online','âœ… Synced');
        $("#lastSyncTime").textContent=formatTime(Date.now());
      });
    }catch(e){
      console.error('Firebase save error:',e);
      updateSyncStatus('offline','âŒ Offline');
    }
  }
};

const saveStateDebounced=()=>{
  clearTimeout(saveTimer);
  saveTimer=setTimeout(saveState,500);
};

const loadState=()=>{
  try{
    const result=localStorage.getItem('sportclub:state');
    if(result){
      const parsed=JSON.parse(result);
      appState={...defaultState,...parsed};
      Object.keys(defaultState).forEach(k=>{
        if(typeof defaultState[k]==="object"&&!Array.isArray(defaultState[k])){
          appState[k]={...defaultState[k],...(parsed[k]||{})}
        }
      });
    }
    if(!appState.sync.deviceId){
      appState.sync.deviceId=uid();
      saveState();
    }
    if(!appState.events)appState.events=[];
    
    // âœ… MIGRATION: Convert old scheduleId to new structure
    if(appState.attendance && appState.attendance.length > 0){
      appState.attendance = appState.attendance.map(a => {
        if(a.scheduleId && !a.eventId){
          return {
            ...a,
            eventType: 'training',
            eventId: a.scheduleId,
            notes: a.notes || ''
          };
        }
        if(!a.eventType){
          a.eventType = a.eventId ? 'training' : 'training';
          a.notes = a.notes || '';
        }
        return a;
      });
    }
  }catch(e){
    console.error('Load error:',e)
  }
  applyTheme();
};

const startRealtimeSync=()=>{
  if(!db || !appState.sync.syncCode)return;
  
  syncRef=db.ref(`sync/${appState.sync.syncCode}`);
  
  syncRef.on('value',(snapshot)=>{
    const remoteData=snapshot.val();
    
    if(!remoteData){
      if(!isInitialLoad){
        db.ref(`sync/${appState.sync.syncCode}`).set(appState);
      }
      isInitialLoad=false;
      return;
    }
    
    if(remoteData.sync.deviceId===appState.sync.deviceId&&remoteData.sync.version<=appState.sync.version){
      isInitialLoad=false;
      return;
    }
    
    if(remoteData.sync.version>appState.sync.version||isInitialLoad){
      const myDeviceId=appState.sync.deviceId;
      appState={...remoteData};
      appState.sync.deviceId=myDeviceId;
      
      localStorage.setItem('sportclub:state',JSON.stringify(appState));
      
      if(!isInitialLoad){
        renderAllViews();
        showToast("ğŸ”„ Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ Î¬Î»Î»Î· ÏƒÏ…ÏƒÎºÎµÏ…Î®","info");
      }
      
      isInitialLoad=false;
      updateSyncStatus('online','âœ… Connected');
      $("#lastSyncTime").textContent=formatTime(Date.now());
    }
  });
  
  db.ref('.info/connected').on('value',(snap)=>{
    if(snap.val()===true){
      updateSyncStatus('online','âœ… Online');
      $("#connectionStatus").textContent="ğŸŸ¢ Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿";
    }else{
      updateSyncStatus('offline','âš ï¸ Offline');
      $("#connectionStatus").textContent="ğŸ”´ Î‘Ï€Î¿ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿";
    }
  });
};

const stopRealtimeSync=()=>{
  if(syncRef){
    syncRef.off();
    syncRef=null;
  }
};

const updateSyncStatus=(type,text)=>{
  const dot=$("#syncDot");
  const status=$("#syncStatus");
  
  if(type==='online'){
    dot.className='status-dot online';
  }else if(type==='syncing'){
    dot.className='status-dot syncing';
  }else{
    dot.className='status-dot';
  }
  
  status.textContent=text;
};

const generateSyncCode=()=>{
  const code=Math.random().toString(36).substring(2,6).toUpperCase()+"-"+Math.random().toString(36).substring(2,6).toUpperCase();
  
  stopRealtimeSync();
  appState.sync.syncCode=code;
  appState.sync.version=1;
  
  $("#syncCode").textContent=code;
  saveState();
  startRealtimeSync();
  
  showToast("âœ… ÎÎ­Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚: "+code,"success");
};

// ============================================
// ğŸ¨ UI FUNCTIONS
// ============================================
const showToast=(msg,type="info")=>{const toast=$("#toast");toast.textContent=msg;toast.className=`notification-toast show ${type}`;setTimeout(()=>toast.classList.remove("show"),3500)};
const openModal=(id)=>{const m=$(`#${id}`);if(m){m.classList.add("active");document.body.style.overflow="hidden"}};
const closeModal=(id)=>{const m=$(`#${id}`);if(m){m.classList.remove("active");document.body.style.overflow=""}};
const switchView=(n)=>{$$(".view").forEach(v=>v.classList.remove("active"));$$(".tab-btn").forEach(b=>b.classList.remove("active"));$(`#${n}`).classList.add("active");$(`[data-view="${n}"]`).classList.add("active");window.scrollTo(0,0);renderActiveView()};
const applyTheme=()=>{document.body.dataset.theme=appState.settings.theme;$("#themeIcon").textContent=appState.settings.theme==="dark"?"ğŸŒ™":"â˜€ï¸"};

// ============================================
// ğŸ“Š RENDER FUNCTIONS
// ============================================
const renderAllViews=()=>{
  renderDashboard();
  renderTeams();
  renderPlayers();
  renderSchedule();
  renderAttendance();
  renderEvents();
  renderReports();
};

const renderActiveView=()=>{
  const active=$(".tab-btn.active")?.dataset.view;
  if(active==="dashboard")renderDashboard();
  if(active==="teams")renderTeams();
  if(active==="players")renderPlayers();
  if(active==="schedule")renderSchedule();
  if(active==="attendance")renderAttendance();
  if(active==="events")renderEvents();
  if(active==="reports")renderReports();
  if(active==="settings")renderSettings();
};

const renderTeamSelector=(containerId)=>{
  const container=$(containerId);
  if(!container)return;
  container.innerHTML="";
  appState.teams.forEach(t=>{
    const chip=document.createElement("div");
    chip.className=`team-chip ${t.id===getCurrentTeam()?"active":""}`;
    chip.textContent=t.name;
    chip.style.borderColor=t.color;
    if(t.id===getCurrentTeam())chip.style.background=t.color;
    chip.addEventListener("click",()=>setCurrentTeam(t.id));
    container.appendChild(chip);
  });
};

const renderDashboard=()=>{
  renderTeamSelector("#dashboardTeamSelector");
  checkTrainingReminder();
  
  const now=new Date();
  $("#currentDate").textContent=now.toLocaleDateString("el-GR",{day:"2-digit",month:"2-digit"});
  
  const teamPlayers=getTeamPlayers();
  const active=teamPlayers.filter(p=>p.active);
  
  $("#totalPlayers").textContent=teamPlayers.length;
  $("#activePlayers").textContent=active.length;
  
  const today=todayISO();
  const teamPlayerIds=teamPlayers.map(p=>p.id);
  const todayAtt=appState.attendance.filter(a=>a.date===today&&teamPlayerIds.includes(a.playerId));
  const todayPresent=todayAtt.filter(a=>a.attended).length;
  const todayRate=todayAtt.length?Math.round((todayPresent/todayAtt.length)*100):0;
  $("#todayAttendance").textContent=todayRate+"%";
  $("#todayAttendance").style.color=todayRate>=80?"var(--success)":todayRate>=50?"var(--warning)":"var(--danger)";
  
  const upcomingEvents=getTeamEvents().filter(e=>new Date(e.date)>=new Date(today)).length;
  $("#upcomingEvents").textContent=upcomingEvents;
  
  const weekAgo=new Date();
  weekAgo.setDate(weekAgo.getDate()-7);
  const weekly=appState.attendance.filter(a=>new Date(a.date)>=weekAgo&&teamPlayerIds.includes(a.playerId));
  const weeklyPresent=weekly.filter(a=>a.attended).length;
  const weeklyRate=weekly.length?Math.round((weeklyPresent/weekly.length)*100):0;
  
  renderUpcomingSchedule();
  renderWeeklyChart();
};

